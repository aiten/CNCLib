<div>
  <h1>Machine control</h1>
</div>

<p *ngIf="isLoading">
  <em>Loading()...</em>
</p>

<div *ngIf="!isLoading">
  <div *ngIf="!isConnected">
    <p>NOT Connected...</p>
  </div>
  <div *ngIf="isConnected">

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm">
          <machinecontrolmove></machinecontrolmove>
        </div>

        <div class="col-sm">

          <label style="width: 60px">G-Command: </label><input #gCode (keyup.enter)="postcommand(gCode.value); gCode.value=''"/>

          <p></p><label style="width: 60px">Info</label>
          <button (click)='postcommand("?")'>Info</button>
          <button (click)='postcommand("&")'>Debug</button>
          <button (click)='postcommand("@")'>Version</button>
          <button (click)='postcommand("!")'>abort</button>
          <button (click)='postcommand("!!!")'>resurrect</button>

          <p></p><label style="width: 60px">Offset</label>
          <button (click)='postcommand("g92")'>clear</button>
          <button (click)='postcommand("g92x0")'>set X</button>
          <button (click)='postcommand("g92y0")'>set Y</button>
          <button (click)='postcommand("g92z0")'>set Z</button>

          <p></p><label style="width: 60px">Probe</label>
          <button (click)='sendWhileOkcommands(["g91 g31z-"+machineControlGlobal.probeDist+"f100 g90","g92 z-"+machineControlGlobal.probeSize,"g91 g0z"+machineControlGlobal.retractDist+" g90"])'>probe Z</button>
          <label>dist </label><input style="width: 60px" type="number" step="0.1" min="0" max="100" [value]="machineControlGlobal.probeDist" (input)="machineControlGlobal.probeDist=$event.target.value"/>
          <label>size </label><input style="width: 60px" type="number" step="0.01" min="0" max="100" [value]="machineControlGlobal.probeSize" (input)="machineControlGlobal.probeSize=$event.target.value"/>
          <label>retract </label><input style="width: 60px" type="number" step="0.01" min="0" max="100" [value]="machineControlGlobal.retractDist" (input)="machineControlGlobal.retractDist=$event.target.value"/>

          <div *ngIf="serialServer.getMachine().spindle">
            <p></p><label style="width: 60px">Spindle</label>
            <button (click)='postcommand("m3")'>on</button>
            <button (click)='postcommand("m5")'>off</button>
          </div>

          <div *ngIf="serialServer.getMachine().laser">
            <p></p><label style="width: 60px">Laser</label>
            <button (click)='postcommand("m3")'>on</button>
            <button (click)='postcommand("m3 s1")'>on(min)</button>
            <button (click)='postcommand("m3 s255")'>on(max)</button>
            <button (click)='postcommand("m5")'>off</button>
          </div>

          <p></p><label style="width: 60px">Ref</label>
          <button (click)='postcommand("g28 x0")'>X</button>
          <button (click)='postcommand("g28 y0")'>Y</button>
          <button (click)='postcommand("g28 z0")'>Z</button>

          <div *ngIf="serialServer.getMachine().SDSupport">
            <p></p><label style="width: 60px">SD</label>
            <button (click)='postcommand("m20")'>dir</button>
          </div>
        </div>

        <div class="col-sm">
          <div class="container-fluid">
            <div class="row">
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=0></machinecontrolworkoffset>
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=1></machinecontrolworkoffset>
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=2></machinecontrolworkoffset>
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=3></machinecontrolworkoffset>
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=4></machinecontrolworkoffset>
              <machinecontrolworkoffset class="col-sm workOfs" [offsetId]=5></machinecontrolworkoffset>
            </div>
          </div>
        </div>
      </div>
    </div>

    <serialporthistory [autoreloadonempty]=true>Loading...</serialporthistory>
  </div>
</div>
